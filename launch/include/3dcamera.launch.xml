<!-- -->
<launch>
  <arg name="camera"  value="camera"/>
  <arg name="manager" value="$(arg camera)_nodelet_manager" />
  


  <!-- TF frames -->
  <arg name="rgb_frame_id"   default="rgb_camera_link_optical" />
  <arg name="depth_frame_id" default="depth_camera_link_optical" />

  <arg name="pi/2" value="1.5707963267948966" />
  <arg name="optical_rotate" value="0 0 0 -$(arg pi/2) 0 -$(arg pi/2)" />
  <node pkg="tf" type="static_transform_publisher" name="camera_base_link1" args="$(arg optical_rotate) rgb_camera_link $(arg rgb_frame_id) 20" />  
  <node pkg="tf" type="static_transform_publisher" name="camera_base_link2" args="$(arg optical_rotate) depth_camera_link $(arg depth_frame_id) 20" />


  <!-- By default, calibrations are stored to file://${ROS_HOME}/camera_info/${NAME}.yaml,
       where ${NAME} is of the form "[rgb|depth]_[serial#]", e.g. "depth_B00367707227042B".
       See camera_info_manager docs for calibration URL details. -->
  <arg name="rgb_camera_info_url"   default="" />
  <arg name="depth_camera_info_url" default="" />


  <!-- Hardware depth registration -->
  <arg name="depth_registration" default="true" />

  <!-- Driver parameters -->
  <arg name="color_depth_synchronization"     default="false" />
  <arg name="auto_exposure"                   default="true" />
  <arg name="auto_white_balance"              default="true" />

  <!-- Arguments for remapping all device namespaces -->
  <arg name="rgb"              default="rgb" />
  <arg name="ir"               default="ir" />
  <arg name="depth"            default="depth" />
  <arg name="depth_registered" default="depth_registered" />

  <!-- Worker threads for the nodelet manager -->
  <arg name="num_worker_threads" default="4" />
  
  <group ns="$(arg camera)">
    <node pkg="nodelet" type="nodelet" name="$(arg manager)" respawn="true" args="manager">
    	<param name="num_worker_threads"              value="$(arg num_worker_threads)" /> 
    </node>
    <node pkg="nodelet" type="nodelet" name="openni2_camera" args="load openni2_camera/OpenNI2DriverNodelet $(arg manager)" respawn="true">
    
		<param name="rgb_camera_info_url"   value="$(arg rgb_camera_info_url)" />
		<param name="depth_camera_info_url" value="$(arg depth_camera_info_url)" />
		<param name="rgb_frame_id"   value="$(arg rgb_frame_id)" />
		<param name="depth_frame_id" value="$(arg depth_frame_id)" />

		<param name="depth_registration" value="$(arg depth_registration)" />
		<param name="color_depth_synchronization" value="$(arg color_depth_synchronization)" />
		<param name="auto_exposure" value="$(arg auto_exposure)" />
		<param name="auto_white_balance" value="$(arg auto_white_balance)" />

		<remap from="ir" to="$(arg ir)" />
		<remap from="rgb" to="$(arg rgb)" />
		<remap from="depth" to="$(arg depth)" />
		<remap from="depth_registered" to="$(arg depth_registered)" />

		<remap from="$(arg rgb)/image" to="$(arg rgb)/image_raw" />
		<remap from="$(arg depth)/image" to="$(arg depth_registered)/image_raw" />

    </node>

    <node pkg="nodelet" type="nodelet" name="depthimage_to_laserscan_loader" args="load depthimage_to_laserscan/DepthImageToLaserScanNodelet $(arg manager)">
        <param name="scan_height" value="60"/>
        <param name="output_frame_id" value="/depth_camera_link"/>
        <param name="range_min" value="0.3"/>
		<param name="range_max" value="4.0"/>
        <remap from="image" to="depth/image_raw"/>
        <remap from="scan" to="/scan"/>
    </node>
  </group>
</launch>
